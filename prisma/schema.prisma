generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id    Int    @id @default(autoincrement())
  name  String
  email String @unique
  password String
  refreshToken   String?
  profile Profile? @relation("UserProfile")
  roles  UserRole[]
  createdProducts Product[] @relation("CreatedBy")
  updatedProducts Product[] @relation("UpdatedBy")
}

model Role {
  id     Int      @id @default(autoincrement())
  name   String   @unique
  users  UserRole[]
}

model UserRole {
  userId   Int
  roleId   Int
  assignedAt DateTime @default(now())

  user   User @relation(fields: [userId], references: [id])
  role   Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
}

model Product {
  id        Int     @id @default(autoincrement())
  name      String
  quanlity  Int
  price1    Float
  price2    Float
  imageUrl  String @db.NVarChar(1024)

  createdBy   Int
  updatedBy   Int?

  createdUser User @relation("CreatedBy", fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  updatedUser User? @relation("UpdatedBy", fields: [updatedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Profile {
  id     Int    @id @default(autoincrement())
  bio    String
  userId Int    @unique  
  user   User   @relation("UserProfile", fields: [userId], references: [id])
}